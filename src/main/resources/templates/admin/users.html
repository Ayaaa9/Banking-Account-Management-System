<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Gestion des Utilisateurs</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<style>
		body {
			display: flex;
			flex-direction: column;
			min-height: 100vh;
			font-family: 'Roboto', sans-serif;
			background-color: #f5f5f5;
			color: #333;
		}

		main {
			flex: 1;
			margin-top: 60px;
			padding: 2rem;
		}

		.content-wrapper {
			background: #ffffff;
			border-radius: 12px;
			padding: 30px;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
		}

		#searchInput {
			max-width: 300px;
		}

		footer {
			background: none;
			color: #666;
			text-align: center;
			padding: 0.5rem 0;
			font-size: 0.85rem;
			border-top: 1px solid #e0e0e0;
			width: 100%;
		}

		footer a {
			color: #666;
			text-decoration: none;
		}

		footer a:hover {
			text-decoration: underline;
		}
	</style>
</head>
<body>

<!-- ✅ NAVBAR -->
<nav class="navbar navbar-dark bg-dark fixed-top">
	<div class="container-fluid">
		<a class="navbar-brand d-flex align-items-center" th:href="@{/admin/home}">
			<img th:src="@{/img/card.png}" alt="Logo" width="40" height="40" />
			<strong class="ms-2">Utilisateurs</strong>
		</a>
		<button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasDarkNavbar">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="offcanvas offcanvas-end text-bg-dark" id="offcanvasDarkNavbar">
			<div class="offcanvas-header">
				<h5 class="offcanvas-title">Navigation</h5>
				<button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
			</div>
			<div class="offcanvas-body">
				<ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
					<li class="nav-item"><a class="nav-link" th:href="@{/admin/home}"><i class="bi bi-house-door me-1"></i> Accueil</a></li>
					<li class="nav-item"><a class="nav-link active" th:href="@{/users}"><i class="bi bi-people-fill me-1"></i> Utilisateurs</a></li>
					<li class="nav-item"><a class="nav-link" th:href="@{/admin/comptes}"><i class="bi bi-wallet2 me-1"></i> Comptes</a></li>
					<li class="nav-item"><a class="nav-link" th:href="@{/admin/demandes}"><i class="bi bi-file-earmark-text me-1"></i> Demandes</a></li>
				</ul>
				<hr class="dropdown-divider" />
				<div class="dropdown d-flex align-items-center">
					<a class="btn btn-sm btn-outline-info dropdown-toggle text-white" href="#" data-bs-toggle="dropdown">
						<i class="bi bi-person-circle me-1"></i>
						<b th:text="${session.connectedUser.role}"></b> :
						<i th:text="${session.connectedUser.firstName + ' ' + session.connectedUser.lastName}"></i>
					</a>
					<ul class="dropdown-menu dropdown-menu-end">
						<li><a class="dropdown-item text-danger fw-bold" th:href="@{/logout}"><i class="bi bi-box-arrow-right me-1"></i> Déconnexion</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</nav>

<!-- ✅ CONTENU -->
<main>
	<div class="content-wrapper container">

		<div class="d-flex justify-content-between align-items-center mb-4">
			<h4 class="mb-0 text-secondary">Liste des Utilisateurs</h4>
			<a th:href="@{/admin/ajoutUser}" class="btn btn-info text-white px-4 py-2">
				<i class="bi bi-plus-circle"></i> Ajouter un utilisateur
			</a>
		</div>

		<!-- ✅ Barre de recherche -->
		<div class="d-flex justify-content-end mb-3">
			<input type="text" id="searchInput" class="form-control" placeholder="Rechercher..." />
		</div>

		<!-- ✅ MESSAGES SESSION -->
		<div th:if="${session.userMessage}" class="alert alert-success text-center" th:text="${session.userMessage}"></div>
		<div th:if="${session.userError}" class="alert alert-danger text-center" th:text="${session.userError}"></div>

		<!-- ✅ TABLE UTILISATEURS -->
		<table class="table table-striped table-hover text-center align-middle">
			<thead class="table-dark">
			<tr>
				<th>Nom</th>
				<th>Prénom</th>
				<th>Login</th>
				<th>Rôle</th>
				<th>Actions</th>
			</tr>
			</thead>
			<tbody>
			<tr th:each="user : ${users}">
				<td th:text="${user.lastName}"></td>
				<td th:text="${user.firstName}"></td>
				<td th:text="${user.username}"></td>
				<td th:text="${user.role}"></td>
				<td>
					<a th:href="@{'/users/edit?id=' + ${user.id}}" class="btn btn-outline-warning btn-sm me-1">
						<i class="bi bi-pencil-fill"></i>
					</a>
					<a th:href="@{'/users/delete?id=' + ${user.id}}" class="btn btn-outline-danger btn-sm">
						<i class="bi bi-trash-fill"></i>
					</a>
				</td>
			</tr>
			</tbody>
		</table>

	</div>
</main>

<!-- ✅ FOOTER -->
<footer>
	Bankati © 2025 – Tous droits réservés – <a href="https://bankati.com">www.bankati.com</a>
</footer>

<!-- ✅ Script de recherche -->
<script>
	document.getElementById("searchInput").addEventListener("keyup", function () {
		const filter = this.value.toLowerCase();
		const rows = document.querySelectorAll("tbody tr");

		rows.forEach(row => {
			const text = row.innerText.toLowerCase();
			row.style.display = text.includes(filter) ? "" : "none";
		});
	});
</script>
</body>
</html>
